(()=>{"use strict";var e,t,s,r,n,a;!function(e){e.OK="ok",e.ERROR="error"}(e||(e={})),function(e){e.GET="GET",e.POST="POST"}(t||(t={})),function(e){e.sources="sources",e.everything="everything"}(s||(s={})),function(e){e.ar="Argentina",e.au="Australia",e.br="Brazil",e.ca="Canada",e.de="Germany",e.es="Spain",e.fr="France",e.gb="United Kingdom",e.ie="Ireland",e.in="India",e.is="Israel",e.it="Italy",e.nl="Netherlands",e.no="Norway",e.pk="Pakistan",e.ru="Russia",e.sa="Saudi Arabia",e.se="Sweden",e.us="United States",e.za="South Africa",e.zh="China"}(r||(r={})),function(e){e.business="business",e.entertainment="entertainment",e.general="general",e.health="health",e.science="science",e.sports="sports",e.technology="technology"}(n||(n={})),function(e){e.ar="Arabic",e.de="German",e.en="English",e.es="Spanish",e.fr="French",e.he="Hebrew",e.it="Italian",e.nl="Dutch",e.no="Norwegian",e.pt="Portuguese",e.ru="Russian",e.sv="Swedish",e.ud="Urdu",e.zh="Chinese"}(a||(a={}));class i{constructor(e,t){this.baseLink=e,this.options=t}getResp({endpoint:e,options:s={}},r){this.load(t.GET,e,r,s).catch((()=>{}))}makeUrl(e,t){const s=Object.assign(Object.assign({},this.options),e);let r=`${this.baseLink}${t}?`;return Object.keys(s).forEach((e=>{r+=`${e}=${s[e]}&`})),r.slice(0,-1)}load(t,s,r,n={}){return a=this,i=void 0,c=function*(){try{const a=yield fetch(this.makeUrl(n,s),{method:t});if(!a.ok||200!==a.status)throw Error(`Sorry, but there is ${a.status} error: ${a.statusText}`);const i=yield a.json();if(i.status===e.ERROR)throw Error(i.message);r(i)}catch(e){console.log(e)}},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{n(c.next(e))}catch(e){t(e)}}function r(e){try{n(c.throw(e))}catch(e){t(e)}}function n(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,r)}n((c=c.apply(a,i||[])).next())}));var a,i,o,c}}class o extends i{constructor(){super("https://rss-news-api.onrender.com/",{apiKey:"a110b858782643e69538761c75334b8c"})}}class c extends o{constructor(){super(...arguments),this.currentFilters={country:[],category:[],language:[]}}getSources(e){super.getResp({endpoint:s.sources},e)}createFilters(e){const{sources:t}=e,s={};return["country","category","language"].forEach((e=>{s[e]=this.filterByKey(t,e)})),this.filteredSources=s,s}filterByKey(e,t){return e.reduce(((e,s)=>{const r=s[t];return e[r]=(e[r]||[]).concat(s),e}),{})}filterSources(e){let{target:t}=e;const s=e.currentTarget;for(;t!==s&&t instanceof HTMLElement;){if(t.classList.contains("filters__item-label")){const e=t.getAttribute("data-filter-key"),s=t.getAttribute("data-filter-value"),r=t.querySelector("input");let n;r&&e&&s&&(n=r.checked,n?this.currentFilters[e].push(s):this.currentFilters[e]=this.currentFilters[e].filter((e=>e!==s)));let a=[];return Object.keys(this.currentFilters).forEach((e=>{const t=this.currentFilters[e];t.length&&(a.length?a=a.filter((s=>t.includes(s[e]))):t.forEach((t=>a.push(...this.filteredSources[e][t]))))})),a}t=t.parentNode}return[]}getNews(e,t){let{target:r}=e;const n=e.currentTarget;for(;r!==n&&r instanceof HTMLElement;){if(r.classList.contains("source__item")){const e=r.getAttribute("data-source-id");if(n instanceof HTMLElement){const r=n.getAttribute("data-source");e&&r!==e&&(n.setAttribute("data-source",e),super.getResp({endpoint:s.everything,options:{sources:e}},t))}return!0}r=r.parentNode}return!1}}class l{constructor({parent:e=null,tag:t="div",className:s="",content:r=""}){const n=document.createElement(t);n.className=s,n.innerHTML=r,e&&e.append(n),this.node=n}remove(){this.node.remove()}appendTo(e){e.append(this.node)}append(...e){const t=e.map((e=>e instanceof HTMLElement?e:e.node));this.node.append(...t)}addListener(e,t){this.node.addEventListener(e,t)}setAttributes(e){Object.entries(e).forEach((([e,t])=>this.node.setAttribute(e,t)))}removeAttributes(...e){e.forEach((e=>this.node.removeAttribute(e)))}setContent(e){this.node.textContent=e}addClass(...e){this.node.classList.add(...e)}removeClass(...e){this.node.classList.remove(...e)}toggleClass(e,t){this.node.classList.toggle(e,t)}get style(){return this.node.style}}class u{constructor(e){this.parent=e;const t=new l({parent:e,className:"sources__filters filters",content:'<h3 class="filters__title">Filters</h3>'});this.filtersWrapper=new l({parent:t,className:"filters__wrapper"}).node,this.dictionary={language:a,country:r,category:n}}draw(e){Object.keys(e).forEach((t=>{const s=new l({parent:this.filtersWrapper,className:"filters__item",content:`<div class="filters__item-name">${t}</div>`}),r=new l({parent:s,className:"filters__item-values"});Object.keys(e[t]).forEach((e=>{r.append(this.createLabel(t,e))}))}))}createLabel(e,t){const s=new l({className:"filters__item-label",tag:"label",content:`<input type="checkbox" class="filters__item-checkbox" value ="${t}">${this.dictionary[e][t]}`});return s.setAttributes({"data-filter-key":e,"data-filter-value":t}),s.node}}class h{constructor(e){this.newsWrapper=new l({parent:e,className:"news"}).node}draw(e){const t=e.length>=10?e.filter(((e,t)=>t<10)):e,s=document.createDocumentFragment();t.forEach(((e,t)=>{const r=new l({className:"news__item"});t%2&&r.addClass("alt");const n=new l({parent:r,className:"news__meta"}),a=new l({parent:n,className:"news__meta-photo"});e.urlToImage&&(a.style.backgroundImage=`url(${e.urlToImage})`);const i=new l({parent:n,tag:"ul",className:"news__meta-details"});new l({parent:i,tag:"li",className:"news__meta-author"}).setContent(e.author||e.source.name),new l({parent:i,tag:"li",className:"news__meta-date"}).setContent(e.publishedAt.slice(0,10).split("-").reverse().join("-"));const o=new l({parent:r,className:"news__description"}),c=new l({tag:"h2",className:"news__description-title",content:e.title}),u=new l({tag:"h3",className:"news__description-source",content:e.source.name}),h=new l({tag:"p",className:"news__description-content",content:e.description}),d=new l({tag:"p",className:"news__read-more",content:`<a href="${e.url}" target="_blank">Read more</a>`});o.append(c,u,h,d),s.append(r.node)})),this.newsWrapper.innerHTML="",this.newsWrapper.appendChild(s)}}class d{constructor(e){this.sourcesWrapper=new l({parent:e,className:"sources"}).node,this.sourcesContainer=new l({parent:this.sourcesWrapper,className:"sources__container"}).node}draw(e){this.sourcesContainer.innerHTML="";const t=document.createDocumentFragment();e.forEach((e=>{const s=this.createSource(e);t.append(s)})),this.sourcesContainer.append(t)}createSource(e){const t=new l({className:"source__item"}),s=new l({className:"source__item-name",tag:"span",content:e.name});return t.append(s),t.setAttributes({"data-source-id":e.id}),t.node}toggle(){this.sourcesWrapper.classList.toggle("closed")}}class p{constructor(e,t){this.parent=e,this.trigger=t,this.sources=new d(e),this.filters=new u(this.getSourcesElement()),this.news=new h(e)}drawNews(e){var t;const s=null!==(t=null==e?void 0:e.articles)&&void 0!==t?t:[];this.news.draw(s)}drawSources(e){var t;const s=Array.isArray(e)?e:null!==(t=null==e?void 0:e.sources)&&void 0!==t?t:[];this.sources.draw(s)}getSourcesElement(){return this.sources.sourcesWrapper}getFiltersElement(){return this.filters.filtersWrapper}toggleSources(){this.trigger.classList.toggle("closed"),this.sources.toggle()}drawFilters(e){this.filters.draw(e)}}class g{constructor(e,t){this.parent=e,this.trigger=t,this.controller=new c,this.view=new p(this.parent,t)}start(){const e=this.view.getSourcesElement();this.controller.getSources((e=>{this.processSources(e)})),e.addEventListener("click",(e=>{!0===this.controller.getNews(e,(e=>this.view.drawNews(e)))&&this.view.toggleSources()})),this.view.getFiltersElement().addEventListener("click",(e=>{const t=this.controller.filterSources(e);this.view.drawSources(t)})),this.trigger.addEventListener("click",(()=>this.view.toggleSources()))}processSources(e){const t=this.controller.createFilters(e);this.view.drawFilters(t),this.view.drawSources(e)}}const m=document.querySelector("main"),w=document.querySelector(".sources-trigger");m&&w&&new g(m,w).start()})();