!function(){"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var s;e.g.importScripts&&(s=e.g.location+"");var t=e.g.document;if(!s&&t&&(t.currentScript&&(s=t.currentScript.src),!s)){var i=t.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&!s;)s=i[n--].src}if(!s)throw new Error("Automatic publicPath is not supported in this browser");s=s.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=s}();class s{static#e={};on(e,t){return s.#e[e]||(s.#e[e]=[]),s.#e[e].push(t),t}off(e,t){s.#e[e]&&(s.#e[e]=s.#e[e].filter((e=>e!==t)))}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];s.#e[e]&&s.#e[e].forEach((e=>{e(...i)}))}}class t extends s{constructor(e){let{parentNode:s=null,tag:t="div",className:i="",content:n="",attributes:o={}}=e;super();const a=document.createElement(t);a.className=i,a.innerHTML=n,s&&s.append(a),this.node=a,this.setAttributes(o)}remove(){this.node.remove()}appendTo(e){(e instanceof HTMLElement?e:e.node).append(this.node)}append(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];const i=s.map((e=>e instanceof HTMLElement?e:e.node));this.node.append(...i)}addListener(e,s){this.node.addEventListener(e,s)}setAttributes(e){Object.entries(e).forEach((e=>{let[s,t]=e;return this.node.setAttribute(s,t)}))}removeAttributes(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];s.forEach((e=>this.node.removeAttribute(e)))}setContent(e){this.node.textContent=e}addClass(){this.node.classList.add(...arguments)}removeClass(){this.node.classList.remove(...arguments)}toggleClass(e,s){this.node.classList.toggle(e,s)}}var i=new t({className:"header",tag:"header",content:'<h1 class="header-title">Minesweeper</h1> '});class n extends t{constructor(e,s,t){super({parentNode:e,className:"cell"}),this.row=s,this.col=t,this.isBomb=!1,this.isOpen=!1,this.isFlagged=!1,this.node.onclick=()=>this.handleClick(),this.node.oncontextmenu=e=>this.handleRightClick(e),this.node.onanimationend=()=>this.removeClass("neighbour")}handleClick(){this.isFlagged||this.emit("clickOnCell",this)}reveal(){if(!this.isOpen&&!this.isFlagged){if(this.isBomb)return this.addClass("bomb"),void this.emit("bomb");this.isOpen=!0,this.addClass("open"),this.setAttributes({"data-bombs":this.isEmpty?"":this.bombsAround})}}handleRightClick(e){e.preventDefault(),this.isOpen||(this.flag(),this.emit("updateFlagsCounter",this.isFlagged))}flag(){this.isOpen||(this.isFlagged=!this.isFlagged,this.toggleClass("flag",this.isFlagged))}setBombsAmount(e){this.bombsAround=e,this.isEmpty=0===this.bombsAround&&!this.isBomb}setBomb(){this.isBomb=!0}reset(){this.isBomb=!1,this.isOpen=!1,this.isFlagged=!1,this.toggleClass("flag",this.isFlagged),this.toggleClass("open",this.isOpen),this.toggleClass("bomb",this.isBomb),this.removeAttributes("data-bombs")}}class o extends t{constructor(e,s){let{rows:t,cols:i,bombs:n}=s;super({parentNode:e,className:"field"}),this.init(t,i,n),this.on("clickOnCell",(e=>this.revealCell(e))),this.bombHandler=this.on("bomb",(()=>this.handleBomb())),this.isBombListnerActive=!0,this.on("changeBombsAmount",(e=>this.changeBombsAmount(e)))}init(e,s,t){this.rows=e,this.cols=s,this.bombsAmount=t,this.cells={},this.createCells(),this.revealedCells=0}createBombs(e){const s=`${e.row},${e.col}`;this.bombs=new Set;const t=Object.keys(this.cells).filter((e=>e!==s));for(;this.bombs.size<this.bombsAmount;){const e=Math.floor(Math.random()*t.length);this.bombs.add(t[e]),t.splice(e,1)}this.bombs.forEach((e=>this.cells[e].setBomb())),this.countBombs()}revealCell(e){if(0===this.revealedCells&&(this.createBombs(e),this.emit("startGame")),!e.isOpen||!e.isEmpty){if(e.isOpen&&!e.isEmpty){const s=this.getNeighbours(e),t=s.filter((e=>!e.isOpen&&!e.isFlagged));if(0===t.length)return;if(s.filter((e=>e.isFlagged)).length!==e.bombsAround)return void t.forEach((e=>{e.addClass("neighbour")}));this.revealNeighbours(e)}e.reveal(),e.isBomb?this.revealBombs():(this.emit("move"),e.isEmpty&&this.revealNeighbours(e),this.revealedCells=Object.values(this.cells).filter((e=>e.isOpen)).length,this.emit("updateCellsCounter",this.revealedCells))}}revealNeighbours(e){const s=new Set(this.getNeighbours(e));for(const e of s)e.reveal(),e.isEmpty&&this.getNeighbours(e).forEach((e=>s.add(e)))}createCells(){for(let e=0;e<this.rows;e+=1){const s=new t({parentNode:this.node,className:"row"});for(let t=0;t<this.cols;t+=1){const i=`${e},${t}`,o=new n(s,e,t);this.cells[i]=o}}}countBombs(){Object.values(this.cells).forEach((e=>{e.setBombsAmount(this.countNeighboursBombs(e))}))}getNeighbours(e){const{row:s,col:t}=e,i=[];for(let e=s-1;e<=s+1;e+=1)for(let n=t-1;n<=t+1;n+=1){const o=`${e},${n}`;if(o!==`${s},${t}`){const e=this.cells[o];e&&i.push(e)}}return i}countNeighboursBombs(e){return this.getNeighbours(e).filter((e=>e.isBomb)).length}revealBombs(){this.bombs.forEach((e=>this.cells[e].reveal()))}handleBomb(){this.off("bomb",this.bombHandler),this.isBombListnerActive=!1,this.revealBombs(),this.emit("lose")}reset(){this.revealedCells=0,Object.values(this.cells).forEach((e=>e.reset())),this.isBombListnerActive||this.on("bomb",this.bombHandler)}save(){return{bombs:Array.from(this.bombs),openCells:Object.values(this.cells).filter((e=>e.isOpen)).map((e=>`${e.row},${e.col}`)),flaggedCells:Object.values(this.cells).filter((e=>e.isFlagged)).map((e=>`${e.row},${e.col}`))}}restore(e){this.bombs=new Set(e.bombs),this.bombs.forEach((e=>this.cells[e].setBomb())),this.countBombs(),e.flaggedCells.forEach((e=>this.cells[e].flag())),e.openCells.forEach((e=>this.cells[e].reveal())),this.revealedCells=e.openCells.length,this.emit("updateCellsCounter",this.revealedCells)}changeBombsAmount(e){this.bombsAmount=e,this.reset()}changeSize(e,s,t){this.node.innerHTML="",this.init(e,s,t),this.isBombListnerActive||this.on("bomb",this.bombHandler)}}class a extends t{constructor(e,s){super({parentNode:e,className:"game"}),this.settings=s,this.createStatusElements(),this.init(),this.fieldWrapper=new t({parentNode:this,className:"field-wrapper"}),this.field=new o(this.fieldWrapper,this.settings),this.createFieldBlocker(),this.resultEl=new t({parentNode:this.node,className:"game-result"}),this.increaseTime=()=>{this.time+=1,this.renderTime()},this.on("startGame",(()=>{this.gameStarted=!0,this.startTimer()})),this.on("lose",(()=>this.lose())),this.on("move",(()=>{this.moves+=1,this.renderMoves()})),this.on("updateCellsCounter",(e=>this.checkWin(e))),this.on("updateFlagsCounter",(e=>this.updateFlags(e))),this.on("newGame",(()=>this.newGame())),this.on("pause",(()=>this.togglePause())),this.on("openModal",(()=>{this.isGameActive&&!this.isPaused&&this.togglePause()}))}init(){this.isGameActive=!1,this.gameStarted=!1,this.bombsLeft=this.settings.bombs,this.cellsToWin=this.settings.rows*this.settings.cols-this.settings.bombs,this.moves=0,this.flagsCounter=0,this.time=0,this.isEnded=!1,this.isPaused=!1,this.renderBombs(),this.renderMoves(),this.renderTime(),this.renderFlags()}createFieldBlocker(){this.fieldBlocker=new t({parentNode:this.field.node,className:"game-blocker"})}createStatusElements(){const e=new t({parentNode:this.node,className:"game-status"});this.bombsEl=new t({parentNode:e,className:"game-bombs"}),this.flagsEl=new t({parentNode:e,className:"game-flags"}),this.movesEl=new t({parentNode:e,className:"game-moves"}),this.timeEl=new t({parentNode:e,className:"game-time"})}renderTime(){this.timeEl.setContent(Math.min(999,this.time).toString().padStart(3,"0"))}renderMoves(){this.movesEl.setContent(this.moves)}renderBombs(){this.bombsEl.setContent(this.bombsLeft)}renderFlags(){this.flagsEl.setContent(this.flagsCounter)}newGame(){this.isGameActive&&this.end(),this.field.reset(),this.init(),this.fieldBlocker.toggleClass("active",this.isEnded),this.fieldBlocker.toggleClass("paused",this.isPaused),this.hideResult()}startTimer(){this.isEnded||(this.isGameActive=!0,this.timer=setInterval((()=>{this.increaseTime()}),1e3))}stopTimer(){clearInterval(this.timer)}togglePause(){!this.isEnded&&this.gameStarted&&(this.isPaused=!this.isPaused,this.fieldBlocker.toggleClass("active",this.isPaused),this.fieldBlocker.toggleClass("paused",this.isPaused),this.isPaused?this.stopTimer():this.startTimer())}end(){this.stopTimer(),this.isGameActive=!1,this.isEnded=!0,this.fieldBlocker.toggleClass("active",this.isEnded)}checkWin(e){if(e===this.cellsToWin){this.end();const e=`Hooray! You found all mines in ${this.time} seconds and ${this.moves} moves!`;this.showResult(e),this.emit("win",{time:this.time,moves:this.moves})}}lose(){this.end(),this.showResult("Game over. Try again")}showResult(e){this.resultEl.setContent(e)}hideResult(){this.resultEl.setContent("")}updateFlags(e){const s=e?1:-1;this.bombsLeft-=s,this.flagsCounter+=s,this.renderBombs(),this.renderFlags()}save(){return{time:this.time,moves:this.moves,flags:this.flagsCounter,field:this.field.save()}}restore(e){this.moves=e.moves,this.time=e.time,this.flagsCounter=e.flags,this.bombsLeft-=this.flagsCounter,this.field.restore(e.field),this.gameStarted=!0,this.startTimer(),this.togglePause(),this.renderBombs(),this.renderMoves(),this.renderTime(),this.renderFlags()}changeField(e){let{rows:s,cols:t,bombs:i}=e;if(this.settings.rows===s&&this.settings.cols===t)return this.settings.bombs=i,this.emit("changeBombsAmount",i),this.end(),this.hideResult(),this.init(),this.fieldBlocker.toggleClass("active",this.isEnded),void this.fieldBlocker.toggleClass("paused",this.isPaused);this.settings.rows=s,this.settings.cols=t,this.settings.bombs=i,this.end(),this.field.changeSize(s,t,i),this.createFieldBlocker(),this.hideResult(),this.init()}}class h extends t{constructor(e,s,t){super({parentNode:e,className:"settings"}),this.parentNode=e,this.settings={...s},this.score=[...t],this.customSettings={...this.settings.lastLevel},this.createModal(e),this.createGameButtons(),this.createSettingsWrapper(),this.on("updateScore",(e=>{this.score=e})),this.on("changeLevel",(()=>this.closeModal()))}createGameButtons(){const e=new t({parentNode:this,className:"game-buttons"});this.newGameButton=new t({tag:"button",parentNode:e,className:"btn btn-new-game",content:"New Game"}),this.pauseBtn=new t({parentNode:e,tag:"button",className:"btn btn-game-pause",content:"Pause"}),this.newGameButton.addListener("click",(()=>this.emit("newGame"))),this.pauseBtn.addListener("click",(()=>this.emit("pause")))}createSettingsWrapper(){this.settingsWrapper=new t({parentNode:this,className:"settings-wrapper"}),this.scoreButton=new t({parentNode:this.settingsWrapper,className:"settings-icon settings-icon-score"}),this.soundSwitcher=new t({parentNode:this.settingsWrapper,className:"settings-icon settings-icon-sound"}),this.themeSwitcher=new t({parentNode:this.settingsWrapper,className:"settings-icon settings-icon-theme"}),this.changeLevelBtn=new t({parentNode:this.settingsWrapper,className:"settings-icon settings-icon-level"}),this.themeSwitcher.toggleClass("dark",this.settings.darkTheme),this.soundSwitcher.toggleClass("muted",!this.settings.sounds),this.scoreButton.addListener("click",(()=>this.showScore())),this.changeLevelBtn.addListener("click",(()=>this.showLevels())),this.themeSwitcher.addListener("click",(()=>{this.settings.darkTheme=!this.settings.darkTheme,this.themeSwitcher.toggleClass("dark",this.settings.darkTheme),this.emit("changeTheme",this.settings.darkTheme)})),this.soundSwitcher.addListener("click",(()=>{this.settings.sounds=!this.settings.sounds,this.soundSwitcher.toggleClass("muted",!this.settings.sounds),this.emit("changeSounds",this.settings.sounds)}))}createModal(e){this.modal=new t({parentNode:e,className:"modal"});const s=new t({tag:"button",className:"modal-close",content:"X"});s.addListener("click",(()=>this.closeModal())),this.modal.addListener("click",(()=>this.closeModal())),this.modal.append(s)}showScore(){this.emit("openModal");const e=new t({className:"modal-header",tag:"h2",content:"Score"}),s=["Size","Bombs","Moves","Time"].reduce(((e,s)=>`${e}<th class = "th">${s}</th>`),""),i=new t({tag:"table",className:"score-table",content:`<thead class = "thead"><tr class = "tr">${s}</tr></thead>`}),n=new t({tag:"tbody",className:"tbody"});i.append(n),this.score.forEach((e=>{let{size:s,bombs:i,time:o,moves:a}=e;const h=new t({tag:"tr",content:`<td>${s}</td><td>${i}</td><td>${a}</td><td>${o}</td>`,className:"t-row"});n.append(h)})),this.modal.content=new t({className:"modal-content"}),this.modal.content.append(e,i),this.modal.content.appendTo(this.modal),this.modal.content.addListener("click",(e=>e.stopPropagation())),this.modal.addClass("open")}showLevels(){this.emit("openModal"),this.modal.content=new t({className:"modal-content"});const e=new t({className:"levels"}),s=new t({parentNode:e,className:"levels-default",content:'<h2 class="levels-title">Default</h2>'}),{levels:i}=this.settings;Object.keys(i).forEach((e=>{const n=i[e],o=new t({parentNode:s,className:"level",content:`<h3 class="level-title">${e}</h3>`});new t({parentNode:o,tag:"button",className:"btn btn-levels",content:`Size: ${n.rows} x ${n.cols}\n        <br>Bombs: ${n.bombs}`}).addListener("click",(()=>this.emit("changeLevel",n)))}));const n=new t({parentNode:e,className:"levels-custom",content:'<h2 class="levels-title">Custom</h2>'});Object.keys(this.customSettings).forEach((e=>{const s=new t({tag:"label",className:"label",content:`${e}: `}),i=new t({tag:"input",className:"input",attributes:{type:"number",value:this.customSettings[e]}});i.addListener("change",(()=>this.setCustomProperty(e,Number(i.node.value)))),s.append(i),n.append(s)}));const o=new t({tag:"button",className:"btn btn-levels",content:"Start"});o.addListener("click",(()=>this.emit("changeLevel",this.customSettings))),n.append(o),this.modal.content.append(e),this.modal.content.appendTo(this.modal),this.modal.addClass("open"),this.modal.content.addListener("click",(e=>e.stopPropagation()))}setCustomProperty(e,s){const[t,i]=[10,99],n=Math.min(i,Math.max(t,s));this.customSettings[e]=n}closeModal(){this.modal.removeClass("open"),this.modal.content.remove()}}var l=JSON.parse('{"levels":{"easy":{"rows":10,"cols":10,"bombs":10},"medium":{"rows":15,"cols":15,"bombs":20},"hard":{"rows":25,"cols":25,"bombs":40}},"sounds":true,"darkTheme":false}'),r=e.p+"assets/audio/8d23566b35621981ed38.mp3",c=e.p+"assets/audio/273f5df708bf41423eea.mp3",d=e.p+"assets/audio/d26fdc4d2a592b5b9151.mp3",m=e.p+"assets/audio/cb31a0ce00016d07fcbd.mp3";class g extends s{constructor(e){super(),this.settings=e,this.win=new Audio(r),this.lose=new Audio(c),this.click=new Audio(d),this.flag=new Audio(m),this.on("win",(()=>{this.settings.sounds&&this.win.play()})),this.on("lose",(()=>{this.settings.sounds&&this.lose.play()})),this.on("move",(()=>{this.settings.sounds&&this.click.play()})),this.on("updateFlagsCounter",(()=>{this.settings.sounds&&this.flag.play()}))}}const u="DeePee-MineSweeper";function b(e,s){localStorage.setItem(`${u}-${e}`,JSON.stringify(s))}function p(e){const s=localStorage.getItem(`${u}-${e}`);return s?JSON.parse(s):null}const v=new t({parentNode:document.body,className:"root"});v.append(i);const f=new class extends s{constructor(e){super(),this.parentNode=e,this.getSettings(),this.getScore(),this.getLastGame(),this.changeTheme(this.settings.darkTheme),this.game=new a(e,this.settings.lastLevel),this.lastGame&&this.game.restore(this.lastGame),this.ui=new h(e,this.settings,this.score),this.sound=new g(this.settings),this.on("win",(e=>this.saveResult(e))),this.on("startGame",(()=>this.saveSettings())),this.on("changeLevel",(e=>this.handleFieldChange(e))),this.on("changeTheme",(e=>this.changeTheme(e))),this.on("changeSounds",(e=>this.changeSounds(e)))}getSettings(){this.settings=p("settings")??l,this.settings.lastLevel=this.settings.lastLevel??{...this.settings.levels.easy}}saveSettings(){b("settings",this.settings)}getScore(){this.score=p("score")??[]}saveResult(e){let{time:s,moves:t}=e;const i={size:`${this.settings.lastLevel.rows} x ${this.settings.lastLevel.cols}`,bombs:this.settings.lastLevel.bombs,time:s,moves:t};this.score.length>=10&&(this.score.length=9),this.score=[i,...this.score],this.emit("updateScore",this.score),b("score",this.score)}getLastGame(){this.lastGame=p("lastGame"),localStorage.removeItem(`${u}-lastGame`)}saveCurrentGame(){this.game.isGameActive&&b("lastGame",this.game.save())}handleFieldChange(e){Object.keys(e).filter((s=>e[s]!==this.settings.lastLevel[s])).length&&(this.settings.lastLevel={...e},this.saveSettings(),this.game.changeField(e)),this.game.newGame()}changeTheme(e){this.parentNode.toggleClass("theme-dark",e),this.settings.darkTheme=e,this.saveSettings()}changeSounds(e){this.settings.sounds=e,this.saveSettings()}}(v);window.addEventListener("beforeunload",(()=>f.saveCurrentGame()))}();